<!DOCTYPE html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content=JamFox><link href=https://docs.jamfox.dev/content/devops/packerci/ rel=canonical><link href=../terraform/ rel=prev><link href=../gitlabrunnershare/ rel=next><link rel=icon href=../../../assets/icon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.7.0"><title>Automated OpenStack image builds with Packer and GitLab CI/CD - JamFox's Documentation</title><link rel=stylesheet href=../../../assets/stylesheets/main.618322db.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.ab4e12ef.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Noto+Sans:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Noto Sans";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../stylesheets/extra.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script defer src=https://cloud.umami.is/script.js data-website-id=bead9d93-4ef7-4e94-b53b-c936abe55767></script><link href=../../../assets/stylesheets/glightbox.min.css rel=stylesheet><script src=../../../assets/javascripts/glightbox.min.js></script><style id=glightbox-style>
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color); }
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color); }
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color); }
        </style></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=light-blue data-md-color-accent=light-blue> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#automated-openstack-image-pipeline class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../.. title="JamFox's Documentation" class="md-header__button md-logo" aria-label="JamFox's Documentation" data-md-component=logo> <img src=../../../assets/icon.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> JamFox's Documentation </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Automated OpenStack image builds with Packer and GitLab CI/CD </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=light-blue data-md-color-accent=light-blue aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"></path></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"></path></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"></path></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/JamFox/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg> </div> <div class=md-source__repository> github.com/JamFox </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../homelab/ class=md-tabs__link> HomeLab </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../ class=md-tabs__link> DevOps </a> </li> <li class=md-tabs__item> <a href=../../food/ class=md-tabs__link> Food &amp; Drinks </a> </li> <li class=md-tabs__item> <a href=../../links/ class=md-tabs__link> Links </a> </li> <li class=md-tabs__item> <a href=../../extras/ class=md-tabs__link> Other </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title="JamFox's Documentation" class="md-nav__button md-logo" aria-label="JamFox's Documentation" data-md-component=logo> <img src=../../../assets/icon.png alt=logo> </a> JamFox's Documentation </label> <div class=md-nav__source> <a href=https://github.com/JamFox/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg> </div> <div class=md-source__repository> github.com/JamFox </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../homelab/ class=md-nav__link> <span class=md-ellipsis> HomeLab </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <div class="md-nav__link md-nav__container"> <a href=../ class="md-nav__link "> <span class=md-ellipsis> DevOps </span> </a> <label class="md-nav__link " for=__nav_3 id=__nav_3_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> DevOps </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2> <label class=md-nav__link for=__nav_3_2 id=__nav_3_2_label tabindex> <span class=md-ellipsis> Version Control </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> Version Control </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../semver/ class=md-nav__link> <span class=md-ellipsis> Semantic Versioning </span> </a> </li> <li class=md-nav__item> <a href=../gitbasics/ class=md-nav__link> <span class=md-ellipsis> Git For Beginners </span> </a> </li> <li class=md-nav__item> <a href=../gitdos/ class=md-nav__link> <span class=md-ellipsis> Git DOs &amp; DON'Ts </span> </a> </li> <li class=md-nav__item> <a href=../precommit/ class=md-nav__link> <span class=md-ellipsis> Precommit </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3> <label class=md-nav__link for=__nav_3_3 id=__nav_3_3_label tabindex> <span class=md-ellipsis> Performance Testing &amp; Benchmarking </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> Performance Testing &amp; Benchmarking </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../performance-testing-benchmarking/ class=md-nav__link> <span class=md-ellipsis> Performance Testing &amp; Benchmarking </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_4> <label class=md-nav__link for=__nav_3_4 id=__nav_3_4_label tabindex> <span class=md-ellipsis> Configuration Management </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_4_label aria-expanded=false> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> Configuration Management </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../saltstack-for-ansible/ class=md-nav__link> <span class=md-ellipsis> Ansible User's Guide to Saltstack </span> </a> </li> <li class=md-nav__item> <a href=../ansiblevault/ class=md-nav__link> <span class=md-ellipsis> Ansible Vault </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_5> <label class=md-nav__link for=__nav_3_5 id=__nav_3_5_label tabindex> <span class=md-ellipsis> Provisioning </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_5_label aria-expanded=false> <label class=md-nav__title for=__nav_3_5> <span class="md-nav__icon md-icon"></span> Provisioning </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../packer/ class=md-nav__link> <span class=md-ellipsis> Hashicorp Packer </span> </a> </li> <li class=md-nav__item> <a href=../terraform/ class=md-nav__link> <span class=md-ellipsis> Hashicorp Terraform </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_6 checked> <label class=md-nav__link for=__nav_3_6 id=__nav_3_6_label tabindex> <span class=md-ellipsis> GitLab </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_6_label aria-expanded=true> <label class=md-nav__title for=__nav_3_6> <span class="md-nav__icon md-icon"></span> GitLab </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> OpenStack Packer GitLab CI/CD </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> OpenStack Packer GitLab CI/CD </span> </a> <nav class="md-nav md-nav--secondary" aria-label="On this page"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> On this page </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#automated-openstack-image-pipeline class=md-nav__link> <span class=md-ellipsis> Automated OpenStack image pipeline </span> </a> <nav class=md-nav aria-label="Automated OpenStack image pipeline"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#build-stage class=md-nav__link> <span class=md-ellipsis> Build stage </span> </a> </li> <li class=md-nav__item> <a href=#upload-stage class=md-nav__link> <span class=md-ellipsis> Upload stage </span> </a> </li> <li class=md-nav__item> <a href=#share-stage class=md-nav__link> <span class=md-ellipsis> Share stage </span> </a> </li> <li class=md-nav__item> <a href=#full-pipeline class=md-nav__link> <span class=md-ellipsis> Full Pipeline </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../gitlabrunnershare/ class=md-nav__link> <span class=md-ellipsis> Sharing Runners To Multiple Projects </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_7> <label class=md-nav__link for=__nav_3_7 id=__nav_3_7_label tabindex> <span class=md-ellipsis> Orchestration </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_7_label aria-expanded=false> <label class=md-nav__title for=__nav_3_7> <span class="md-nav__icon md-icon"></span> Orchestration </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../orchestrationexplained/ class=md-nav__link> <span class=md-ellipsis> Orchestration Fundamentals Explained Simply </span> </a> </li> <li class=md-nav__item> <a href=../consul/ class=md-nav__link> <span class=md-ellipsis> Hashicorp Consul </span> </a> </li> <li class=md-nav__item> <a href=../nomad/ class=md-nav__link> <span class=md-ellipsis> Hashicorp Nomad </span> </a> </li> <li class=md-nav__item> <a href=../kubernetes/ class=md-nav__link> <span class=md-ellipsis> Kubernetes </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_8> <label class=md-nav__link for=__nav_3_8 id=__nav_3_8_label tabindex> <span class=md-ellipsis> Secrets Management </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_8_label aria-expanded=false> <label class=md-nav__title for=__nav_3_8> <span class="md-nav__icon md-icon"></span> Secrets Management </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../vaultad/ class=md-nav__link> <span class=md-ellipsis> Vault with AD </span> </a> </li> <li class=md-nav__item> <a href=../vaultkrb/ class=md-nav__link> <span class=md-ellipsis> Vault with Kerberos </span> </a> </li> <li class=md-nav__item> <a href=../sops/ class=md-nav__link> <span class=md-ellipsis> Mozilla SOPS </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../networking/ class=md-nav__link> <span class=md-ellipsis> Networking </span> </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_10> <label class=md-nav__link for=__nav_3_10 id=__nav_3_10_label tabindex> <span class=md-ellipsis> Storage </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_10_label aria-expanded=false> <label class=md-nav__title for=__nav_3_10> <span class="md-nav__icon md-icon"></span> Storage </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ceph/ class=md-nav__link> <span class=md-ellipsis> Ceph </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_11> <label class=md-nav__link for=__nav_3_11 id=__nav_3_11_label tabindex> <span class=md-ellipsis> AI </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_11_label aria-expanded=false> <label class=md-nav__title for=__nav_3_11> <span class="md-nav__icon md-icon"></span> AI </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ai-build/ class=md-nav__link> <span class=md-ellipsis> Building AI </span> </a> </li> <li class=md-nav__item> <a href=../prompteng/ class=md-nav__link> <span class=md-ellipsis> Prompt Engineering </span> </a> </li> <li class=md-nav__item> <a href=../stablediffusion/ class=md-nav__link> <span class=md-ellipsis> Stable Diffusion </span> </a> </li> <li class=md-nav__item> <a href=../stablediffusion-ps1/ class=md-nav__link> <span class=md-ellipsis> Playstation Filter Using Stable Diffusion </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_12> <label class=md-nav__link for=__nav_3_12 id=__nav_3_12_label tabindex> <span class=md-ellipsis> Red Teaming &amp; Penetration Testing </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_12_label aria-expanded=false> <label class=md-nav__title for=__nav_3_12> <span class="md-nav__icon md-icon"></span> Red Teaming &amp; Penetration Testing </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../redteaming/ class=md-nav__link> <span class=md-ellipsis> Red Teaming </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../food/ class=md-nav__link> <span class=md-ellipsis> Food &amp; Drinks </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../links/ class=md-nav__link> <span class=md-ellipsis> Links </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../extras/ class=md-nav__link> <span class=md-ellipsis> Other </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="On this page"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> On this page </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#automated-openstack-image-pipeline class=md-nav__link> <span class=md-ellipsis> Automated OpenStack image pipeline </span> </a> <nav class=md-nav aria-label="Automated OpenStack image pipeline"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#build-stage class=md-nav__link> <span class=md-ellipsis> Build stage </span> </a> </li> <li class=md-nav__item> <a href=#upload-stage class=md-nav__link> <span class=md-ellipsis> Upload stage </span> </a> </li> <li class=md-nav__item> <a href=#share-stage class=md-nav__link> <span class=md-ellipsis> Share stage </span> </a> </li> <li class=md-nav__item> <a href=#full-pipeline class=md-nav__link> <span class=md-ellipsis> Full Pipeline </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/JamFox/docs.jamfox.dev/raw/master/docs/content/devops/packerci.md title="View source of this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"></path></svg> </a> <h1>OpenStack Packer GitLab CI/CD</h1> <p>The following is documentation for how to automate building, uploading and sharing images in OpenStack projects with Packer, Qemu via GiLab CI/CD pipelines using inherited settings using extended playbooks from templates and yml achors.</p> <p>Requirements you need to replicate the following:</p> <ul> <li>Priviledged GitLab Runner with a tag: https://gitlab.cern.ch/gitlabci-examples/demo-privileged-runners</li> <li>GitLab docker-in-docker executor for the priviledged runner: https://docs.gitlab.com/ce/ci/docker/using_docker_build.html#use-docker-in-docker-executor</li> <li>TLS for docker-in-docker executor: https://docs.gitlab.com/ee/ci/docker/using_docker_build.html#tls-enabled</li> </ul> <p>Project structure:</p> <div class=highlight><table class=highlighttable><tbody><tr><th colspan=2 class=filename><span class=filename>Bash</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-1> 1</a></span>
<span class=normal><a href=#__codelineno-0-2> 2</a></span>
<span class=normal><a href=#__codelineno-0-3> 3</a></span>
<span class=normal><a href=#__codelineno-0-4> 4</a></span>
<span class=normal><a href=#__codelineno-0-5> 5</a></span>
<span class=normal><a href=#__codelineno-0-6> 6</a></span>
<span class=normal><a href=#__codelineno-0-7> 7</a></span>
<span class=normal><a href=#__codelineno-0-8> 8</a></span>
<span class=normal><a href=#__codelineno-0-9> 9</a></span>
<span class=normal><a href=#__codelineno-0-10>10</a></span>
<span class=normal><a href=#__codelineno-0-11>11</a></span>
<span class=normal><a href=#__codelineno-0-12>12</a></span>
<span class=normal><a href=#__codelineno-0-13>13</a></span>
<span class=normal><a href=#__codelineno-0-14>14</a></span>
<span class=normal><a href=#__codelineno-0-15>15</a></span>
<span class=normal><a href=#__codelineno-0-16>16</a></span>
<span class=normal><a href=#__codelineno-0-17>17</a></span>
<span class=normal><a href=#__codelineno-0-18>18</a></span>
<span class=normal><a href=#__codelineno-0-19>19</a></span>
<span class=normal><a href=#__codelineno-0-20>20</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1></a><span class=nv>$PROJECT_ROOT</span>/
<a id=__codelineno-0-2 name=__codelineno-0-2></a>├──<span class=w> </span>.gitlab-ci.yml
<a id=__codelineno-0-3 name=__codelineno-0-3></a>├──<span class=w> </span>provisioning/
<a id=__codelineno-0-4 name=__codelineno-0-4></a>│<span class=w>   </span>└──<span class=w> </span>base/
<a id=__codelineno-0-5 name=__codelineno-0-5></a>│<span class=w>       </span>├──<span class=w> </span>img1-ks.cfg
<a id=__codelineno-0-6 name=__codelineno-0-6></a>│<span class=w>       </span>├──<span class=w> </span>img2-ks.cfg
<a id=__codelineno-0-7 name=__codelineno-0-7></a>│<span class=w>       </span>└──<span class=w> </span>img3-ks.cfg
<a id=__codelineno-0-8 name=__codelineno-0-8></a>│
<a id=__codelineno-0-9 name=__codelineno-0-9></a>├──<span class=w> </span>scripts/
<a id=__codelineno-0-10 name=__codelineno-0-10></a>│<span class=w>   </span>├──<span class=w> </span>img1/
<a id=__codelineno-0-11 name=__codelineno-0-11></a>│<span class=w>   </span>│<span class=w>   </span>└──<span class=w> </span>provision.sh
<a id=__codelineno-0-12 name=__codelineno-0-12></a>│<span class=w>   </span>├──<span class=w> </span>img2/
<a id=__codelineno-0-13 name=__codelineno-0-13></a>│<span class=w>   </span>│<span class=w>   </span>└──<span class=w> </span>provision.sh
<a id=__codelineno-0-14 name=__codelineno-0-14></a>│<span class=w>   </span>└──<span class=w> </span>img3/
<a id=__codelineno-0-15 name=__codelineno-0-15></a>│<span class=w>       </span>└──<span class=w> </span>provision.sh
<a id=__codelineno-0-16 name=__codelineno-0-16></a>│
<a id=__codelineno-0-17 name=__codelineno-0-17></a>└──<span class=w> </span>templates/
<a id=__codelineno-0-18 name=__codelineno-0-18></a><span class=w>    </span>├──<span class=w> </span>img1.json
<a id=__codelineno-0-19 name=__codelineno-0-19></a><span class=w>    </span>├──<span class=w> </span>img2.json
<a id=__codelineno-0-20 name=__codelineno-0-20></a><span class=w>    </span>└──<span class=w> </span>img3.json
</code></pre></div></td></tr></tbody></table></div> <h2 id=automated-openstack-image-pipeline>Automated OpenStack image pipeline<a class=headerlink href=#automated-openstack-image-pipeline title="Anchor link to this section for reference">ඞ</a></h2> <p><code>.gitlab-ci.yml</code> contains steps to build, upload and share image to appropriate projects.</p> <p>Composed of stages:</p> <ul> <li>Build Images</li> <li>Upload Images</li> <li>Share Images</li> </ul> <h3 id=build-stage>Build stage<a class=headerlink href=#build-stage title="Anchor link to this section for reference">ඞ</a></h3> <p>The image build CI stage section will build our images.</p> <p>Image build yml:</p> <div class=highlight><table class=highlighttable><tbody><tr><th colspan=2 class=filename><span class=filename>Text Only</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-1-1> 1</a></span>
<span class=normal><a href=#__codelineno-1-2> 2</a></span>
<span class=normal><a href=#__codelineno-1-3> 3</a></span>
<span class=normal><a href=#__codelineno-1-4> 4</a></span>
<span class=normal><a href=#__codelineno-1-5> 5</a></span>
<span class=normal><a href=#__codelineno-1-6> 6</a></span>
<span class=normal><a href=#__codelineno-1-7> 7</a></span>
<span class=normal><a href=#__codelineno-1-8> 8</a></span>
<span class=normal><a href=#__codelineno-1-9> 9</a></span>
<span class=normal><a href=#__codelineno-1-10>10</a></span>
<span class=normal><a href=#__codelineno-1-11>11</a></span>
<span class=normal><a href=#__codelineno-1-12>12</a></span>
<span class=normal><a href=#__codelineno-1-13>13</a></span>
<span class=normal><a href=#__codelineno-1-14>14</a></span>
<span class=normal><a href=#__codelineno-1-15>15</a></span>
<span class=normal><a href=#__codelineno-1-16>16</a></span>
<span class=normal><a href=#__codelineno-1-17>17</a></span>
<span class=normal><a href=#__codelineno-1-18>18</a></span>
<span class=normal><a href=#__codelineno-1-19>19</a></span>
<span class=normal><a href=#__codelineno-1-20>20</a></span>
<span class=normal><a href=#__codelineno-1-21>21</a></span>
<span class=normal><a href=#__codelineno-1-22>22</a></span>
<span class=normal><a href=#__codelineno-1-23>23</a></span>
<span class=normal><a href=#__codelineno-1-24>24</a></span>
<span class=normal><a href=#__codelineno-1-25>25</a></span>
<span class=normal><a href=#__codelineno-1-26>26</a></span>
<span class=normal><a href=#__codelineno-1-27>27</a></span>
<span class=normal><a href=#__codelineno-1-28>28</a></span>
<span class=normal><a href=#__codelineno-1-29>29</a></span>
<span class=normal><a href=#__codelineno-1-30>30</a></span>
<span class=normal><a href=#__codelineno-1-31>31</a></span>
<span class=normal><a href=#__codelineno-1-32>32</a></span>
<span class=normal><a href=#__codelineno-1-33>33</a></span>
<span class=normal><a href=#__codelineno-1-34>34</a></span>
<span class=normal><a href=#__codelineno-1-35>35</a></span>
<span class=normal><a href=#__codelineno-1-36>36</a></span>
<span class=normal><a href=#__codelineno-1-37>37</a></span>
<span class=normal><a href=#__codelineno-1-38>38</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1></a>############################## BUILD JOBS
<a id=__codelineno-1-2 name=__codelineno-1-2></a>
<a id=__codelineno-1-3 name=__codelineno-1-3></a># This script is not needed, if your container has the following already installed: 
<a id=__codelineno-1-4 name=__codelineno-1-4></a># qemu qemu-img qemu-system-x86_64 qemu-ui-gtk curl jq packer 
<a id=__codelineno-1-5 name=__codelineno-1-5></a>.install-qemu-packer: &amp;install-qemu-packer
<a id=__codelineno-1-6 name=__codelineno-1-6></a>    - apk add qemu qemu-img qemu-system-x86_64 qemu-ui-gtk curl jq
<a id=__codelineno-1-7 name=__codelineno-1-7></a>    - echo "Fetching packer"
<a id=__codelineno-1-8 name=__codelineno-1-8></a>    - current_version=$(curl -s https://checkpoint-api.hashicorp.com/v1/check/packer | jq -r .current_version)
<a id=__codelineno-1-9 name=__codelineno-1-9></a>    - wget https://releases.hashicorp.com/packer/${current_version}/packer_${current_version}_linux_amd64.zip
<a id=__codelineno-1-10 name=__codelineno-1-10></a>    - unzip packer_${current_version}_linux_amd64.zip
<a id=__codelineno-1-11 name=__codelineno-1-11></a>    - chmod +x packer
<a id=__codelineno-1-12 name=__codelineno-1-12></a>
<a id=__codelineno-1-13 name=__codelineno-1-13></a>.default-build-settings:
<a id=__codelineno-1-14 name=__codelineno-1-14></a>  stage: Build Images
<a id=__codelineno-1-15 name=__codelineno-1-15></a>  tags: 
<a id=__codelineno-1-16 name=__codelineno-1-16></a>  - docker-privileged-xl
<a id=__codelineno-1-17 name=__codelineno-1-17></a>  image: docker:19.03.1
<a id=__codelineno-1-18 name=__codelineno-1-18></a>  services:
<a id=__codelineno-1-19 name=__codelineno-1-19></a>  - docker:19.03.1-dind
<a id=__codelineno-1-20 name=__codelineno-1-20></a>  variables:
<a id=__codelineno-1-21 name=__codelineno-1-21></a>      DOCKER_TLS_CERTDIR: "/certs"
<a id=__codelineno-1-22 name=__codelineno-1-22></a>  before_script:
<a id=__codelineno-1-23 name=__codelineno-1-23></a>    - *install-qemu-packer
<a id=__codelineno-1-24 name=__codelineno-1-24></a>  artifacts:
<a id=__codelineno-1-25 name=__codelineno-1-25></a>    paths:
<a id=__codelineno-1-26 name=__codelineno-1-26></a>      - images/*/*.qcow2
<a id=__codelineno-1-27 name=__codelineno-1-27></a>    expire_in: 1 week
<a id=__codelineno-1-28 name=__codelineno-1-28></a>
<a id=__codelineno-1-29 name=__codelineno-1-29></a>build img1:
<a id=__codelineno-1-30 name=__codelineno-1-30></a>  extends:
<a id=__codelineno-1-31 name=__codelineno-1-31></a>    - .default-build-settings
<a id=__codelineno-1-32 name=__codelineno-1-32></a>  script:
<a id=__codelineno-1-33 name=__codelineno-1-33></a>    - PACKER_LOG=1 ./packer build -force templates/img1.json
<a id=__codelineno-1-34 name=__codelineno-1-34></a>  rules:
<a id=__codelineno-1-35 name=__codelineno-1-35></a>    - changes:
<a id=__codelineno-1-36 name=__codelineno-1-36></a>      - templates/img1.json
<a id=__codelineno-1-37 name=__codelineno-1-37></a>      - provisioning/img1-ks.cfg
<a id=__codelineno-1-38 name=__codelineno-1-38></a>    - when: manual
</code></pre></div></td></tr></tbody></table></div> <p>The job to build <code>img1</code> is called <code>build img1</code> and is an extension of <code>.default-build-settings</code>. All image build jobs should inherit <code>.default-build-settings</code> because it sets the settings needed for building images in a way which avoids code duplication. To add the same settings to another image job, we just make sure it contains:</p> <div class=highlight><table class=highlighttable><tbody><tr><th colspan=2 class=filename><span class=filename>Text Only</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-2-1>1</a></span>
<span class=normal><a href=#__codelineno-2-2>2</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1></a>  extends:
<a id=__codelineno-2-2 name=__codelineno-2-2></a>    - .default-build-settings
</code></pre></div></td></tr></tbody></table></div> <p>It will set:</p> <ul> <li>CI stage as <code>Build Images</code></li> <li>CI tag as <code>docker-privileged-xl</code> so that it runs on the correct runner. (Change it to your runners tag)</li> <li>CI image as <code>docker:19.03.1</code> with <code>docker:19.03.1-dind</code> service (Change it to your runner container and service)</li> <li><code>DOCKER_TLS_CERTDIR</code> variable to <code>/certs</code> for docker TLS. (Change it to your TLS path)</li> <li><code>before_script</code> as <code>*install-qemu-packer</code> which installs <code>qemu</code> and the latest <code>packer</code> (This is not needed, if your container has the following already installed: qemu qemu-img qemu-system-x86_64 qemu-ui-gtk curl jq packer)</li> <li>Generated image at <code>images/*/*.qcow2</code> as artifact to be used in corresponding upload image job.</li> </ul> <p>The settings to change for a secific images are:</p> <ul> <li><code>script</code> which should match the json for building the image: <code>PACKER_LOG=1 ./packer build -force templates/&lt;YOUR IMAGE JSON FILE NAME HERE&gt;.json</code> </li> <li><code>rules</code> that should match json and ks.cfg for that image to make sure the pipeline is triggered only when you want. Example only trigger pipeline when the related files are changed or on schecule (See: https://docs.gitlab.com/ee/ci/jobs/job_control.html). </li> </ul> <h3 id=upload-stage>Upload stage<a class=headerlink href=#upload-stage title="Anchor link to this section for reference">ඞ</a></h3> <p>The image upload CI stage section will upload our built images from the previous stage. It will access the image built in the previous stage by using GitLab artifacts that we defined in the inherited settings of <code>.default-build-settings</code>. GitLab doc on artifacts: https://docs.gitlab.com/ee/ci/pipelines/job_artifacts.html</p> <p>For the following to work you need to set some variables for OpenStack authentication. See: https://docs.openstack.org/python-openstackclient/latest/cli/authentication.html</p> <p>These variables are (Change values to fit your environment):</p> <div class=highlight><table class=highlighttable><tbody><tr><th colspan=2 class=filename><span class=filename>Text Only</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-3-1> 1</a></span>
<span class=normal><a href=#__codelineno-3-2> 2</a></span>
<span class=normal><a href=#__codelineno-3-3> 3</a></span>
<span class=normal><a href=#__codelineno-3-4> 4</a></span>
<span class=normal><a href=#__codelineno-3-5> 5</a></span>
<span class=normal><a href=#__codelineno-3-6> 6</a></span>
<span class=normal><a href=#__codelineno-3-7> 7</a></span>
<span class=normal><a href=#__codelineno-3-8> 8</a></span>
<span class=normal><a href=#__codelineno-3-9> 9</a></span>
<span class=normal><a href=#__codelineno-3-10>10</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1></a># OpenStack Authentication URL 
<a id=__codelineno-3-2 name=__codelineno-3-2></a>OS_AUTH_URL: 'https://keystone.cern.ch/v3'
<a id=__codelineno-3-3 name=__codelineno-3-3></a>OS_DEFAULT_DOMAIN: default
<a id=__codelineno-3-4 name=__codelineno-3-4></a># CERN OpenStack API Version 
<a id=__codelineno-3-5 name=__codelineno-3-5></a>OS_IDENTITY_API_VERSION: 3
<a id=__codelineno-3-6 name=__codelineno-3-6></a># OpenStack Default project to authenticate to
<a id=__codelineno-3-7 name=__codelineno-3-7></a>OS_PROJECT_NAME: "$UPLOAD_PROJECT_NAME"
<a id=__codelineno-3-8 name=__codelineno-3-8></a># OpenStack Default authentication method
<a id=__codelineno-3-9 name=__codelineno-3-9></a># Password auth requires you to also set secret variables for user and password which are not included here. These would be OS_USERNAME and OS_PASSWORD
<a id=__codelineno-3-10 name=__codelineno-3-10></a>OS_AUTH_TYPE: v3password
</code></pre></div></td></tr></tbody></table></div> <p>Image upload yml:</p> <div class=highlight><table class=highlighttable><tbody><tr><th colspan=2 class=filename><span class=filename>Text Only</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-4-1> 1</a></span>
<span class=normal><a href=#__codelineno-4-2> 2</a></span>
<span class=normal><a href=#__codelineno-4-3> 3</a></span>
<span class=normal><a href=#__codelineno-4-4> 4</a></span>
<span class=normal><a href=#__codelineno-4-5> 5</a></span>
<span class=normal><a href=#__codelineno-4-6> 6</a></span>
<span class=normal><a href=#__codelineno-4-7> 7</a></span>
<span class=normal><a href=#__codelineno-4-8> 8</a></span>
<span class=normal><a href=#__codelineno-4-9> 9</a></span>
<span class=normal><a href=#__codelineno-4-10>10</a></span>
<span class=normal><a href=#__codelineno-4-11>11</a></span>
<span class=normal><a href=#__codelineno-4-12>12</a></span>
<span class=normal><a href=#__codelineno-4-13>13</a></span>
<span class=normal><a href=#__codelineno-4-14>14</a></span>
<span class=normal><a href=#__codelineno-4-15>15</a></span>
<span class=normal><a href=#__codelineno-4-16>16</a></span>
<span class=normal><a href=#__codelineno-4-17>17</a></span>
<span class=normal><a href=#__codelineno-4-18>18</a></span>
<span class=normal><a href=#__codelineno-4-19>19</a></span>
<span class=normal><a href=#__codelineno-4-20>20</a></span>
<span class=normal><a href=#__codelineno-4-21>21</a></span>
<span class=normal><a href=#__codelineno-4-22>22</a></span>
<span class=normal><a href=#__codelineno-4-23>23</a></span>
<span class=normal><a href=#__codelineno-4-24>24</a></span>
<span class=normal><a href=#__codelineno-4-25>25</a></span>
<span class=normal><a href=#__codelineno-4-26>26</a></span>
<span class=normal><a href=#__codelineno-4-27>27</a></span>
<span class=normal><a href=#__codelineno-4-28>28</a></span>
<span class=normal><a href=#__codelineno-4-29>29</a></span>
<span class=normal><a href=#__codelineno-4-30>30</a></span>
<span class=normal><a href=#__codelineno-4-31>31</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1></a>############################## UPLOAD JOBS
<a id=__codelineno-4-2 name=__codelineno-4-2></a>
<a id=__codelineno-4-3 name=__codelineno-4-3></a>.openstack-upload-image: &amp;openstack-upload-image
<a id=__codelineno-4-4 name=__codelineno-4-4></a>    - echo "Getting image name from image path $IMAGE_PATH" 
<a id=__codelineno-4-5 name=__codelineno-4-5></a>    - export IMAGENAME_FULL=$(basename $IMAGE_PATH/*.qcow2)
<a id=__codelineno-4-6 name=__codelineno-4-6></a>    - echo $IMAGENAME_FULL
<a id=__codelineno-4-7 name=__codelineno-4-7></a>    - export IMAGENAME="[CICD] ${IMAGENAME_FULL%.*}"
<a id=__codelineno-4-8 name=__codelineno-4-8></a>    - echo $IMAGENAME
<a id=__codelineno-4-9 name=__codelineno-4-9></a>    - openstack --os-auth-type $OS_AUTH_TYPE image create --disk-format qcow2 --file ./$IMAGE_PATH/"$IMAGENAME_FULL" "$IMAGENAME"
<a id=__codelineno-4-10 name=__codelineno-4-10></a>    - echo "IMAGE_TO_SHARE=${IMAGENAME}" &gt;&gt; img.env
<a id=__codelineno-4-11 name=__codelineno-4-11></a>
<a id=__codelineno-4-12 name=__codelineno-4-12></a>.default-upload-settings:
<a id=__codelineno-4-13 name=__codelineno-4-13></a>  image:
<a id=__codelineno-4-14 name=__codelineno-4-14></a>    name: gitlab-registry.cern.ch/linuxsupport/openstack-client:latest
<a id=__codelineno-4-15 name=__codelineno-4-15></a>    entrypoint: [""]
<a id=__codelineno-4-16 name=__codelineno-4-16></a>  stage: Upload Images
<a id=__codelineno-4-17 name=__codelineno-4-17></a>  script: 
<a id=__codelineno-4-18 name=__codelineno-4-18></a>    - *openstack-upload-image
<a id=__codelineno-4-19 name=__codelineno-4-19></a>  artifacts:
<a id=__codelineno-4-20 name=__codelineno-4-20></a>    reports:
<a id=__codelineno-4-21 name=__codelineno-4-21></a>      dotenv: img.env
<a id=__codelineno-4-22 name=__codelineno-4-22></a>
<a id=__codelineno-4-23 name=__codelineno-4-23></a>
<a id=__codelineno-4-24 name=__codelineno-4-24></a>upload img1: 
<a id=__codelineno-4-25 name=__codelineno-4-25></a>  extends:
<a id=__codelineno-4-26 name=__codelineno-4-26></a>    - .default-upload-settings
<a id=__codelineno-4-27 name=__codelineno-4-27></a>  needs: ["build img1"]
<a id=__codelineno-4-28 name=__codelineno-4-28></a>  dependencies: 
<a id=__codelineno-4-29 name=__codelineno-4-29></a>    - build img1
<a id=__codelineno-4-30 name=__codelineno-4-30></a>  variables:
<a id=__codelineno-4-31 name=__codelineno-4-31></a>    IMAGE_PATH: images/img1
</code></pre></div></td></tr></tbody></table></div> <p>The job to upload <code>img1</code> is called <code>build img1</code> and is an extension of <code>.default-upload-settings</code>. All image upload jobs should inherit <code>.default-upload-settings</code> because it sets the settings needed for uploading images in a way which avoids code duplication. To add the same settings to another image job, we just make sure it contains:</p> <div class=highlight><table class=highlighttable><tbody><tr><th colspan=2 class=filename><span class=filename>Text Only</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-5-1>1</a></span>
<span class=normal><a href=#__codelineno-5-2>2</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1></a>  extends:
<a id=__codelineno-5-2 name=__codelineno-5-2></a>    - .default-upload-settings
</code></pre></div></td></tr></tbody></table></div> <p>It will set:</p> <ul> <li>CI stage as <code>Upload Images</code></li> <li>CI image to container with OpenStack CLI tools installed.</li> <li><code>script</code> as <code>*openstack-upload-image</code> which uses artifact from corresponding build job that contains the built image and uploads it to the <code>$UPLOAD_PROJECT_NAME</code>.</li> <li>Uploaded image as dotenv variable artifact in <code>img.env</code> that will be used by corresponding share job.</li> </ul> <p>The settings to change for a secific images are:</p> <ul> <li><code>needs</code> which should match your previous build job name wrapped in brackets and quotes: <code>needs: ["&lt;CORRESPONDING BUILD JOB NAME&gt;"]</code></li> <li><code>dependencies</code> which should match your previous build.</li> <li><code>variables</code> which should have <code>IMAGE_PATH</code> that matches your images output path set in your image json.</li> </ul> <h3 id=share-stage>Share stage<a class=headerlink href=#share-stage title="Anchor link to this section for reference">ඞ</a></h3> <p>The image share CI stage section will share our built images from the previous stage to projects we need. It will access the image name variable from <code>img.env</code> that we set in the previous stage by using GitLab artifacts that we defined in the inherited settings of <code>.default-upload-settings</code>. GitLab doc on artifacts: https://docs.gitlab.com/ee/ci/pipelines/job_artifacts.html</p> <p>NOTE: The account you use for authenticating to OpenStack projects MUST have permissions to accept the shared image in the project that you want the image to be shared to! The account authenticates and shares the image from <code>$UPLOAD_PROJECT_NAME</code> and then authenticates and accepts it from <code>$PROJECT_TO_SHARE</code>, so it needs access from both sides of this transaction.</p> <p>Sharing images done according to CU doc: https://www.cac.cornell.edu/wiki/index.php?title=Share_An_Image_In_Openstack</p> <p>Image share yml:</p> <div class=highlight><table class=highlighttable><tbody><tr><th colspan=2 class=filename><span class=filename>Text Only</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-6-1> 1</a></span>
<span class=normal><a href=#__codelineno-6-2> 2</a></span>
<span class=normal><a href=#__codelineno-6-3> 3</a></span>
<span class=normal><a href=#__codelineno-6-4> 4</a></span>
<span class=normal><a href=#__codelineno-6-5> 5</a></span>
<span class=normal><a href=#__codelineno-6-6> 6</a></span>
<span class=normal><a href=#__codelineno-6-7> 7</a></span>
<span class=normal><a href=#__codelineno-6-8> 8</a></span>
<span class=normal><a href=#__codelineno-6-9> 9</a></span>
<span class=normal><a href=#__codelineno-6-10>10</a></span>
<span class=normal><a href=#__codelineno-6-11>11</a></span>
<span class=normal><a href=#__codelineno-6-12>12</a></span>
<span class=normal><a href=#__codelineno-6-13>13</a></span>
<span class=normal><a href=#__codelineno-6-14>14</a></span>
<span class=normal><a href=#__codelineno-6-15>15</a></span>
<span class=normal><a href=#__codelineno-6-16>16</a></span>
<span class=normal><a href=#__codelineno-6-17>17</a></span>
<span class=normal><a href=#__codelineno-6-18>18</a></span>
<span class=normal><a href=#__codelineno-6-19>19</a></span>
<span class=normal><a href=#__codelineno-6-20>20</a></span>
<span class=normal><a href=#__codelineno-6-21>21</a></span>
<span class=normal><a href=#__codelineno-6-22>22</a></span>
<span class=normal><a href=#__codelineno-6-23>23</a></span>
<span class=normal><a href=#__codelineno-6-24>24</a></span>
<span class=normal><a href=#__codelineno-6-25>25</a></span>
<span class=normal><a href=#__codelineno-6-26>26</a></span>
<span class=normal><a href=#__codelineno-6-27>27</a></span>
<span class=normal><a href=#__codelineno-6-28>28</a></span>
<span class=normal><a href=#__codelineno-6-29>29</a></span>
<span class=normal><a href=#__codelineno-6-30>30</a></span>
<span class=normal><a href=#__codelineno-6-31>31</a></span>
<span class=normal><a href=#__codelineno-6-32>32</a></span>
<span class=normal><a href=#__codelineno-6-33>33</a></span>
<span class=normal><a href=#__codelineno-6-34>34</a></span>
<span class=normal><a href=#__codelineno-6-35>35</a></span>
<span class=normal><a href=#__codelineno-6-36>36</a></span>
<span class=normal><a href=#__codelineno-6-37>37</a></span>
<span class=normal><a href=#__codelineno-6-38>38</a></span>
<span class=normal><a href=#__codelineno-6-39>39</a></span>
<span class=normal><a href=#__codelineno-6-40>40</a></span>
<span class=normal><a href=#__codelineno-6-41>41</a></span>
<span class=normal><a href=#__codelineno-6-42>42</a></span>
<span class=normal><a href=#__codelineno-6-43>43</a></span>
<span class=normal><a href=#__codelineno-6-44>44</a></span>
<span class=normal><a href=#__codelineno-6-45>45</a></span>
<span class=normal><a href=#__codelineno-6-46>46</a></span>
<span class=normal><a href=#__codelineno-6-47>47</a></span>
<span class=normal><a href=#__codelineno-6-48>48</a></span>
<span class=normal><a href=#__codelineno-6-49>49</a></span>
<span class=normal><a href=#__codelineno-6-50>50</a></span>
<span class=normal><a href=#__codelineno-6-51>51</a></span>
<span class=normal><a href=#__codelineno-6-52>52</a></span>
<span class=normal><a href=#__codelineno-6-53>53</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1></a>############################## SHARE JOBS
<a id=__codelineno-6-2 name=__codelineno-6-2></a>
<a id=__codelineno-6-3 name=__codelineno-6-3></a>.openstack-share-image: &amp;openstack-share-image
<a id=__codelineno-6-4 name=__codelineno-6-4></a>    - |+
<a id=__codelineno-6-5 name=__codelineno-6-5></a>      IFS=';' read -ra PROJECTS &lt;&lt;&lt; "$PROJECT_TO_SHARE"
<a id=__codelineno-6-6 name=__codelineno-6-6></a>      while IFS=';' read -ra PROJECTS; do
<a id=__codelineno-6-7 name=__codelineno-6-7></a>        for PROJECT in "${PROJECTS[@]}"; do
<a id=__codelineno-6-8 name=__codelineno-6-8></a>          export OS_PROJECT_NAME=$UPLOAD_PROJECT_NAME
<a id=__codelineno-6-9 name=__codelineno-6-9></a>          echo "Sharing image $IMAGE_TO_SHARE from $OS_PROJECT_NAME to $PROJECT"
<a id=__codelineno-6-10 name=__codelineno-6-10></a>          export IMG_ID=$(openstack image list | fgrep "$IMAGE_TO_SHARE" | cut -d " " -f 2)
<a id=__codelineno-6-11 name=__codelineno-6-11></a>          echo "Got image $IMAGE_TO_SHARE ID: $IMG_ID"
<a id=__codelineno-6-12 name=__codelineno-6-12></a>          export SHARE_ID=$(openstack project list | fgrep "$PROJECT" | cut -d " " -f 2)
<a id=__codelineno-6-13 name=__codelineno-6-13></a>          echo "Got project $PROJECT ID: $SHARE_ID"
<a id=__codelineno-6-14 name=__codelineno-6-14></a>          openstack --os-auth-type $OS_AUTH_TYPE image set --shared $IMG_ID
<a id=__codelineno-6-15 name=__codelineno-6-15></a>          openstack --os-auth-type $OS_AUTH_TYPE image add project $IMG_ID $SHARE_ID
<a id=__codelineno-6-16 name=__codelineno-6-16></a>          export OS_PROJECT_NAME=$PROJECT
<a id=__codelineno-6-17 name=__codelineno-6-17></a>          echo "Accepting image share from $PROJECT"
<a id=__codelineno-6-18 name=__codelineno-6-18></a>          openstack --os-auth-type $OS_AUTH_TYPE image set --accept $IMG_ID 
<a id=__codelineno-6-19 name=__codelineno-6-19></a>          export OS_PROJECT_NAME=$UPLOAD_PROJECT_NAME
<a id=__codelineno-6-20 name=__codelineno-6-20></a>        done
<a id=__codelineno-6-21 name=__codelineno-6-21></a>      done &lt;&lt;&lt; "$PROJECT_TO_SHARE"
<a id=__codelineno-6-22 name=__codelineno-6-22></a>
<a id=__codelineno-6-23 name=__codelineno-6-23></a>.default-share-settings:
<a id=__codelineno-6-24 name=__codelineno-6-24></a>  image:
<a id=__codelineno-6-25 name=__codelineno-6-25></a>    name: gitlab-registry.cern.ch/linuxsupport/openstack-client:latest
<a id=__codelineno-6-26 name=__codelineno-6-26></a>    entrypoint: [""]
<a id=__codelineno-6-27 name=__codelineno-6-27></a>  stage: Share Images
<a id=__codelineno-6-28 name=__codelineno-6-28></a>  script: 
<a id=__codelineno-6-29 name=__codelineno-6-29></a>    - *openstack-share-image
<a id=__codelineno-6-30 name=__codelineno-6-30></a>
<a id=__codelineno-6-31 name=__codelineno-6-31></a>.default-share-on-tag:
<a id=__codelineno-6-32 name=__codelineno-6-32></a>  rules:
<a id=__codelineno-6-33 name=__codelineno-6-33></a>    - if: '$CI_COMMIT_TAG != null'
<a id=__codelineno-6-34 name=__codelineno-6-34></a>      when: manual
<a id=__codelineno-6-35 name=__codelineno-6-35></a>
<a id=__codelineno-6-36 name=__codelineno-6-36></a>share img1 to dev:
<a id=__codelineno-6-37 name=__codelineno-6-37></a>  extends:
<a id=__codelineno-6-38 name=__codelineno-6-38></a>    - .default-share-settings
<a id=__codelineno-6-39 name=__codelineno-6-39></a>  needs: ["upload img1"]
<a id=__codelineno-6-40 name=__codelineno-6-40></a>  dependencies: 
<a id=__codelineno-6-41 name=__codelineno-6-41></a>    - upload img1 
<a id=__codelineno-6-42 name=__codelineno-6-42></a>  variables:
<a id=__codelineno-6-43 name=__codelineno-6-43></a>    PROJECT_TO_SHARE: "$DEV_PROJECT_NAME"
<a id=__codelineno-6-44 name=__codelineno-6-44></a>
<a id=__codelineno-6-45 name=__codelineno-6-45></a>share img1 to prod: 
<a id=__codelineno-6-46 name=__codelineno-6-46></a>  extends:
<a id=__codelineno-6-47 name=__codelineno-6-47></a>    - .default-share-settings
<a id=__codelineno-6-48 name=__codelineno-6-48></a>    - .default-share-on-tag
<a id=__codelineno-6-49 name=__codelineno-6-49></a>  needs: ["upload img1"]
<a id=__codelineno-6-50 name=__codelineno-6-50></a>  dependencies: 
<a id=__codelineno-6-51 name=__codelineno-6-51></a>    - upload img1 
<a id=__codelineno-6-52 name=__codelineno-6-52></a>  variables:
<a id=__codelineno-6-53 name=__codelineno-6-53></a>    PROJECT_TO_SHARE: "$PROD_PROJECT_NAME"
</code></pre></div></td></tr></tbody></table></div> <p>The job to share <code>img1</code> is called <code>share img1 to X</code> and is an extension of <code>.default-share-settings</code>. All image share jobs should inherit <code>.default-share-settings</code> because it sets the settings needed for sharing images in a way which avoids code duplication. To add the same settings to another image job, we just make sure it contains:</p> <div class=highlight><table class=highlighttable><tbody><tr><th colspan=2 class=filename><span class=filename>Text Only</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-7-1>1</a></span>
<span class=normal><a href=#__codelineno-7-2>2</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1></a>  extends:
<a id=__codelineno-7-2 name=__codelineno-7-2></a>    - .default-share-settings
</code></pre></div></td></tr></tbody></table></div> <p>It will set:</p> <ul> <li>CI stage as <code>Share Images</code></li> <li>CI image to container with OpenStack CLI tools installed.</li> <li><code>script</code> as <code>*openstack-share-image</code> which loops over the <code>$PROJECT_TO_SHARE</code> variable values which must be separated by ";" and shares them from <code>$UPLOAD_PROJECT_NAME</code> to each project value it finds in <code>$PROJECT_TO_SHARE</code>. This allows us to share image to multiple projects without code duplication.</li> </ul> <p>If you wish to have images that are shared only when a tag is commited, then also inherit <code>.default-share-on-tag</code> which sets the rules to only allow this job to run, when a tag is commited. NOTE: with this setup, after commiting a tag, you must still trigger the job manually! Commiting a tag will just make it available.</p> <p>The settings to change for a secific images are:</p> <ul> <li><code>needs</code> which should match your previous upload job name wrapped in brackets and quotes: <code>needs: ["&lt;CORRESPONDING BUILD JOB NAME&gt;"]</code></li> <li><code>dependencies</code> which should match your previous upload.</li> <li><code>variables</code> which should have <code>PROJECT_TO_SHARE</code> that points to a variable which has project name(s) separated by ";", if there are multiple projects.</li> </ul> <h3 id=full-pipeline>Full Pipeline<a class=headerlink href=#full-pipeline title="Anchor link to this section for reference">ඞ</a></h3> <div class=highlight><table class=highlighttable><tbody><tr><th colspan=2 class=filename><span class=filename>Text Only</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-8-1>  1</a></span>
<span class=normal><a href=#__codelineno-8-2>  2</a></span>
<span class=normal><a href=#__codelineno-8-3>  3</a></span>
<span class=normal><a href=#__codelineno-8-4>  4</a></span>
<span class=normal><a href=#__codelineno-8-5>  5</a></span>
<span class=normal><a href=#__codelineno-8-6>  6</a></span>
<span class=normal><a href=#__codelineno-8-7>  7</a></span>
<span class=normal><a href=#__codelineno-8-8>  8</a></span>
<span class=normal><a href=#__codelineno-8-9>  9</a></span>
<span class=normal><a href=#__codelineno-8-10> 10</a></span>
<span class=normal><a href=#__codelineno-8-11> 11</a></span>
<span class=normal><a href=#__codelineno-8-12> 12</a></span>
<span class=normal><a href=#__codelineno-8-13> 13</a></span>
<span class=normal><a href=#__codelineno-8-14> 14</a></span>
<span class=normal><a href=#__codelineno-8-15> 15</a></span>
<span class=normal><a href=#__codelineno-8-16> 16</a></span>
<span class=normal><a href=#__codelineno-8-17> 17</a></span>
<span class=normal><a href=#__codelineno-8-18> 18</a></span>
<span class=normal><a href=#__codelineno-8-19> 19</a></span>
<span class=normal><a href=#__codelineno-8-20> 20</a></span>
<span class=normal><a href=#__codelineno-8-21> 21</a></span>
<span class=normal><a href=#__codelineno-8-22> 22</a></span>
<span class=normal><a href=#__codelineno-8-23> 23</a></span>
<span class=normal><a href=#__codelineno-8-24> 24</a></span>
<span class=normal><a href=#__codelineno-8-25> 25</a></span>
<span class=normal><a href=#__codelineno-8-26> 26</a></span>
<span class=normal><a href=#__codelineno-8-27> 27</a></span>
<span class=normal><a href=#__codelineno-8-28> 28</a></span>
<span class=normal><a href=#__codelineno-8-29> 29</a></span>
<span class=normal><a href=#__codelineno-8-30> 30</a></span>
<span class=normal><a href=#__codelineno-8-31> 31</a></span>
<span class=normal><a href=#__codelineno-8-32> 32</a></span>
<span class=normal><a href=#__codelineno-8-33> 33</a></span>
<span class=normal><a href=#__codelineno-8-34> 34</a></span>
<span class=normal><a href=#__codelineno-8-35> 35</a></span>
<span class=normal><a href=#__codelineno-8-36> 36</a></span>
<span class=normal><a href=#__codelineno-8-37> 37</a></span>
<span class=normal><a href=#__codelineno-8-38> 38</a></span>
<span class=normal><a href=#__codelineno-8-39> 39</a></span>
<span class=normal><a href=#__codelineno-8-40> 40</a></span>
<span class=normal><a href=#__codelineno-8-41> 41</a></span>
<span class=normal><a href=#__codelineno-8-42> 42</a></span>
<span class=normal><a href=#__codelineno-8-43> 43</a></span>
<span class=normal><a href=#__codelineno-8-44> 44</a></span>
<span class=normal><a href=#__codelineno-8-45> 45</a></span>
<span class=normal><a href=#__codelineno-8-46> 46</a></span>
<span class=normal><a href=#__codelineno-8-47> 47</a></span>
<span class=normal><a href=#__codelineno-8-48> 48</a></span>
<span class=normal><a href=#__codelineno-8-49> 49</a></span>
<span class=normal><a href=#__codelineno-8-50> 50</a></span>
<span class=normal><a href=#__codelineno-8-51> 51</a></span>
<span class=normal><a href=#__codelineno-8-52> 52</a></span>
<span class=normal><a href=#__codelineno-8-53> 53</a></span>
<span class=normal><a href=#__codelineno-8-54> 54</a></span>
<span class=normal><a href=#__codelineno-8-55> 55</a></span>
<span class=normal><a href=#__codelineno-8-56> 56</a></span>
<span class=normal><a href=#__codelineno-8-57> 57</a></span>
<span class=normal><a href=#__codelineno-8-58> 58</a></span>
<span class=normal><a href=#__codelineno-8-59> 59</a></span>
<span class=normal><a href=#__codelineno-8-60> 60</a></span>
<span class=normal><a href=#__codelineno-8-61> 61</a></span>
<span class=normal><a href=#__codelineno-8-62> 62</a></span>
<span class=normal><a href=#__codelineno-8-63> 63</a></span>
<span class=normal><a href=#__codelineno-8-64> 64</a></span>
<span class=normal><a href=#__codelineno-8-65> 65</a></span>
<span class=normal><a href=#__codelineno-8-66> 66</a></span>
<span class=normal><a href=#__codelineno-8-67> 67</a></span>
<span class=normal><a href=#__codelineno-8-68> 68</a></span>
<span class=normal><a href=#__codelineno-8-69> 69</a></span>
<span class=normal><a href=#__codelineno-8-70> 70</a></span>
<span class=normal><a href=#__codelineno-8-71> 71</a></span>
<span class=normal><a href=#__codelineno-8-72> 72</a></span>
<span class=normal><a href=#__codelineno-8-73> 73</a></span>
<span class=normal><a href=#__codelineno-8-74> 74</a></span>
<span class=normal><a href=#__codelineno-8-75> 75</a></span>
<span class=normal><a href=#__codelineno-8-76> 76</a></span>
<span class=normal><a href=#__codelineno-8-77> 77</a></span>
<span class=normal><a href=#__codelineno-8-78> 78</a></span>
<span class=normal><a href=#__codelineno-8-79> 79</a></span>
<span class=normal><a href=#__codelineno-8-80> 80</a></span>
<span class=normal><a href=#__codelineno-8-81> 81</a></span>
<span class=normal><a href=#__codelineno-8-82> 82</a></span>
<span class=normal><a href=#__codelineno-8-83> 83</a></span>
<span class=normal><a href=#__codelineno-8-84> 84</a></span>
<span class=normal><a href=#__codelineno-8-85> 85</a></span>
<span class=normal><a href=#__codelineno-8-86> 86</a></span>
<span class=normal><a href=#__codelineno-8-87> 87</a></span>
<span class=normal><a href=#__codelineno-8-88> 88</a></span>
<span class=normal><a href=#__codelineno-8-89> 89</a></span>
<span class=normal><a href=#__codelineno-8-90> 90</a></span>
<span class=normal><a href=#__codelineno-8-91> 91</a></span>
<span class=normal><a href=#__codelineno-8-92> 92</a></span>
<span class=normal><a href=#__codelineno-8-93> 93</a></span>
<span class=normal><a href=#__codelineno-8-94> 94</a></span>
<span class=normal><a href=#__codelineno-8-95> 95</a></span>
<span class=normal><a href=#__codelineno-8-96> 96</a></span>
<span class=normal><a href=#__codelineno-8-97> 97</a></span>
<span class=normal><a href=#__codelineno-8-98> 98</a></span>
<span class=normal><a href=#__codelineno-8-99> 99</a></span>
<span class=normal><a href=#__codelineno-8-100>100</a></span>
<span class=normal><a href=#__codelineno-8-101>101</a></span>
<span class=normal><a href=#__codelineno-8-102>102</a></span>
<span class=normal><a href=#__codelineno-8-103>103</a></span>
<span class=normal><a href=#__codelineno-8-104>104</a></span>
<span class=normal><a href=#__codelineno-8-105>105</a></span>
<span class=normal><a href=#__codelineno-8-106>106</a></span>
<span class=normal><a href=#__codelineno-8-107>107</a></span>
<span class=normal><a href=#__codelineno-8-108>108</a></span>
<span class=normal><a href=#__codelineno-8-109>109</a></span>
<span class=normal><a href=#__codelineno-8-110>110</a></span>
<span class=normal><a href=#__codelineno-8-111>111</a></span>
<span class=normal><a href=#__codelineno-8-112>112</a></span>
<span class=normal><a href=#__codelineno-8-113>113</a></span>
<span class=normal><a href=#__codelineno-8-114>114</a></span>
<span class=normal><a href=#__codelineno-8-115>115</a></span>
<span class=normal><a href=#__codelineno-8-116>116</a></span>
<span class=normal><a href=#__codelineno-8-117>117</a></span>
<span class=normal><a href=#__codelineno-8-118>118</a></span>
<span class=normal><a href=#__codelineno-8-119>119</a></span>
<span class=normal><a href=#__codelineno-8-120>120</a></span>
<span class=normal><a href=#__codelineno-8-121>121</a></span>
<span class=normal><a href=#__codelineno-8-122>122</a></span>
<span class=normal><a href=#__codelineno-8-123>123</a></span>
<span class=normal><a href=#__codelineno-8-124>124</a></span>
<span class=normal><a href=#__codelineno-8-125>125</a></span>
<span class=normal><a href=#__codelineno-8-126>126</a></span>
<span class=normal><a href=#__codelineno-8-127>127</a></span>
<span class=normal><a href=#__codelineno-8-128>128</a></span>
<span class=normal><a href=#__codelineno-8-129>129</a></span>
<span class=normal><a href=#__codelineno-8-130>130</a></span>
<span class=normal><a href=#__codelineno-8-131>131</a></span>
<span class=normal><a href=#__codelineno-8-132>132</a></span>
<span class=normal><a href=#__codelineno-8-133>133</a></span>
<span class=normal><a href=#__codelineno-8-134>134</a></span>
<span class=normal><a href=#__codelineno-8-135>135</a></span>
<span class=normal><a href=#__codelineno-8-136>136</a></span>
<span class=normal><a href=#__codelineno-8-137>137</a></span>
<span class=normal><a href=#__codelineno-8-138>138</a></span>
<span class=normal><a href=#__codelineno-8-139>139</a></span>
<span class=normal><a href=#__codelineno-8-140>140</a></span>
<span class=normal><a href=#__codelineno-8-141>141</a></span>
<span class=normal><a href=#__codelineno-8-142>142</a></span>
<span class=normal><a href=#__codelineno-8-143>143</a></span>
<span class=normal><a href=#__codelineno-8-144>144</a></span>
<span class=normal><a href=#__codelineno-8-145>145</a></span>
<span class=normal><a href=#__codelineno-8-146>146</a></span>
<span class=normal><a href=#__codelineno-8-147>147</a></span>
<span class=normal><a href=#__codelineno-8-148>148</a></span>
<span class=normal><a href=#__codelineno-8-149>149</a></span>
<span class=normal><a href=#__codelineno-8-150>150</a></span>
<span class=normal><a href=#__codelineno-8-151>151</a></span>
<span class=normal><a href=#__codelineno-8-152>152</a></span>
<span class=normal><a href=#__codelineno-8-153>153</a></span>
<span class=normal><a href=#__codelineno-8-154>154</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1></a>---
<a id=__codelineno-8-2 name=__codelineno-8-2></a>
<a id=__codelineno-8-3 name=__codelineno-8-3></a>stages:
<a id=__codelineno-8-4 name=__codelineno-8-4></a>  - Build Images
<a id=__codelineno-8-5 name=__codelineno-8-5></a>  - Upload Images
<a id=__codelineno-8-6 name=__codelineno-8-6></a>  - Share Images
<a id=__codelineno-8-7 name=__codelineno-8-7></a>
<a id=__codelineno-8-8 name=__codelineno-8-8></a>variables:
<a id=__codelineno-8-9 name=__codelineno-8-9></a>  # OpenStack project name to upload images to
<a id=__codelineno-8-10 name=__codelineno-8-10></a>  UPLOAD_PROJECT_NAME: 'BE ACC-linux'
<a id=__codelineno-8-11 name=__codelineno-8-11></a>  # OpenStack project name(s) to share uploaded images to for testing
<a id=__codelineno-8-12 name=__codelineno-8-12></a>  # For multiple names, use ";" as delimiter
<a id=__codelineno-8-13 name=__codelineno-8-13></a>  DEV_PROJECT_NAME: 'BE-LTS'
<a id=__codelineno-8-14 name=__codelineno-8-14></a>  # OpenStack project name(s) to share uploaded images to for prod
<a id=__codelineno-8-15 name=__codelineno-8-15></a>  # For multiple names, use ";" as delimiter
<a id=__codelineno-8-16 name=__codelineno-8-16></a>  PROD_PROJECT_NAME: 'BE ACC-VPC2016;Remote Operation Gateway'
<a id=__codelineno-8-17 name=__codelineno-8-17></a>  # CERN OpenStack Authentication URL 
<a id=__codelineno-8-18 name=__codelineno-8-18></a>  OS_AUTH_URL: 'https://keystone.cern.ch/v3'
<a id=__codelineno-8-19 name=__codelineno-8-19></a>  OS_DEFAULT_DOMAIN: default
<a id=__codelineno-8-20 name=__codelineno-8-20></a>  # CERN OpenStack API Version
<a id=__codelineno-8-21 name=__codelineno-8-21></a>  OS_IDENTITY_API_VERSION: 3
<a id=__codelineno-8-22 name=__codelineno-8-22></a>  # OpenStack Default project to authenticate to
<a id=__codelineno-8-23 name=__codelineno-8-23></a>  OS_PROJECT_NAME: "$UPLOAD_PROJECT_NAME"
<a id=__codelineno-8-24 name=__codelineno-8-24></a>  # OpenStack Default authentication method
<a id=__codelineno-8-25 name=__codelineno-8-25></a>  # Password auth requires you to set CICD variables for user and password
<a id=__codelineno-8-26 name=__codelineno-8-26></a>  OS_AUTH_TYPE: v3password
<a id=__codelineno-8-27 name=__codelineno-8-27></a>
<a id=__codelineno-8-28 name=__codelineno-8-28></a>
<a id=__codelineno-8-29 name=__codelineno-8-29></a>############################## BUILD JOBS
<a id=__codelineno-8-30 name=__codelineno-8-30></a>
<a id=__codelineno-8-31 name=__codelineno-8-31></a># This script is not needed, if your container has the following already installed: 
<a id=__codelineno-8-32 name=__codelineno-8-32></a># qemu qemu-img qemu-system-x86_64 qemu-ui-gtk curl jq packer 
<a id=__codelineno-8-33 name=__codelineno-8-33></a>.install-qemu-packer: &amp;install-qemu-packer
<a id=__codelineno-8-34 name=__codelineno-8-34></a>    - apk add qemu qemu-img qemu-system-x86_64 qemu-ui-gtk curl jq
<a id=__codelineno-8-35 name=__codelineno-8-35></a>    - echo "Fetching packer"
<a id=__codelineno-8-36 name=__codelineno-8-36></a>    - current_version=$(curl -s https://checkpoint-api.hashicorp.com/v1/check/packer | jq -r .current_version)
<a id=__codelineno-8-37 name=__codelineno-8-37></a>    - wget https://releases.hashicorp.com/packer/${current_version}/packer_${current_version}_linux_amd64.zip
<a id=__codelineno-8-38 name=__codelineno-8-38></a>    - unzip packer_${current_version}_linux_amd64.zip
<a id=__codelineno-8-39 name=__codelineno-8-39></a>    - chmod +x packer
<a id=__codelineno-8-40 name=__codelineno-8-40></a>
<a id=__codelineno-8-41 name=__codelineno-8-41></a>.default-build-settings:
<a id=__codelineno-8-42 name=__codelineno-8-42></a>  stage: Build Images
<a id=__codelineno-8-43 name=__codelineno-8-43></a>  tags: 
<a id=__codelineno-8-44 name=__codelineno-8-44></a>  - docker-privileged-xl
<a id=__codelineno-8-45 name=__codelineno-8-45></a>  image: docker:19.03.1
<a id=__codelineno-8-46 name=__codelineno-8-46></a>  services:
<a id=__codelineno-8-47 name=__codelineno-8-47></a>  - docker:19.03.1-dind
<a id=__codelineno-8-48 name=__codelineno-8-48></a>  variables:
<a id=__codelineno-8-49 name=__codelineno-8-49></a>      DOCKER_TLS_CERTDIR: "/certs"
<a id=__codelineno-8-50 name=__codelineno-8-50></a>  before_script:
<a id=__codelineno-8-51 name=__codelineno-8-51></a>    - *install-qemu-packer
<a id=__codelineno-8-52 name=__codelineno-8-52></a>  artifacts:
<a id=__codelineno-8-53 name=__codelineno-8-53></a>    paths:
<a id=__codelineno-8-54 name=__codelineno-8-54></a>      - images/*/*.qcow2
<a id=__codelineno-8-55 name=__codelineno-8-55></a>    expire_in: 1 week
<a id=__codelineno-8-56 name=__codelineno-8-56></a>
<a id=__codelineno-8-57 name=__codelineno-8-57></a>build img1:
<a id=__codelineno-8-58 name=__codelineno-8-58></a>  extends:
<a id=__codelineno-8-59 name=__codelineno-8-59></a>    - .default-build-settings
<a id=__codelineno-8-60 name=__codelineno-8-60></a>  script:
<a id=__codelineno-8-61 name=__codelineno-8-61></a>    - PACKER_LOG=1 ./packer build -force templates/img1.json
<a id=__codelineno-8-62 name=__codelineno-8-62></a>  rules:
<a id=__codelineno-8-63 name=__codelineno-8-63></a>    - changes:
<a id=__codelineno-8-64 name=__codelineno-8-64></a>      - templates/img1.json
<a id=__codelineno-8-65 name=__codelineno-8-65></a>      - provisioning/img1-ks.cfg
<a id=__codelineno-8-66 name=__codelineno-8-66></a>    - when: manual
<a id=__codelineno-8-67 name=__codelineno-8-67></a>
<a id=__codelineno-8-68 name=__codelineno-8-68></a>
<a id=__codelineno-8-69 name=__codelineno-8-69></a>############################## UPLOAD JOBS
<a id=__codelineno-8-70 name=__codelineno-8-70></a>
<a id=__codelineno-8-71 name=__codelineno-8-71></a>.openstack-upload-image: &amp;openstack-upload-image
<a id=__codelineno-8-72 name=__codelineno-8-72></a>    - echo "Getting image name from image path $IMAGE_PATH" 
<a id=__codelineno-8-73 name=__codelineno-8-73></a>    - export IMAGENAME_FULL=$(basename $IMAGE_PATH/*.qcow2)
<a id=__codelineno-8-74 name=__codelineno-8-74></a>    - echo $IMAGENAME_FULL
<a id=__codelineno-8-75 name=__codelineno-8-75></a>    - export IMAGENAME="[CICD] ${IMAGENAME_FULL%.*}"
<a id=__codelineno-8-76 name=__codelineno-8-76></a>    - echo $IMAGENAME
<a id=__codelineno-8-77 name=__codelineno-8-77></a>    - openstack --os-auth-type $OS_AUTH_TYPE image create --disk-format qcow2 --file ./$IMAGE_PATH/"$IMAGENAME_FULL" "$IMAGENAME"
<a id=__codelineno-8-78 name=__codelineno-8-78></a>    - echo "IMAGE_TO_SHARE=${IMAGENAME}" &gt;&gt; img.env
<a id=__codelineno-8-79 name=__codelineno-8-79></a>
<a id=__codelineno-8-80 name=__codelineno-8-80></a>.default-upload-settings:
<a id=__codelineno-8-81 name=__codelineno-8-81></a>  image:
<a id=__codelineno-8-82 name=__codelineno-8-82></a>    name: gitlab-registry.cern.ch/linuxsupport/openstack-client:latest
<a id=__codelineno-8-83 name=__codelineno-8-83></a>    entrypoint: [""]
<a id=__codelineno-8-84 name=__codelineno-8-84></a>  stage: Upload Images
<a id=__codelineno-8-85 name=__codelineno-8-85></a>  script: 
<a id=__codelineno-8-86 name=__codelineno-8-86></a>    - *openstack-upload-image
<a id=__codelineno-8-87 name=__codelineno-8-87></a>  artifacts:
<a id=__codelineno-8-88 name=__codelineno-8-88></a>    reports:
<a id=__codelineno-8-89 name=__codelineno-8-89></a>      dotenv: img.env
<a id=__codelineno-8-90 name=__codelineno-8-90></a>
<a id=__codelineno-8-91 name=__codelineno-8-91></a>
<a id=__codelineno-8-92 name=__codelineno-8-92></a>upload img1: 
<a id=__codelineno-8-93 name=__codelineno-8-93></a>  extends:
<a id=__codelineno-8-94 name=__codelineno-8-94></a>    - .default-upload-settings
<a id=__codelineno-8-95 name=__codelineno-8-95></a>  needs: ["build img1"]
<a id=__codelineno-8-96 name=__codelineno-8-96></a>  dependencies: 
<a id=__codelineno-8-97 name=__codelineno-8-97></a>    - build img1
<a id=__codelineno-8-98 name=__codelineno-8-98></a>  variables:
<a id=__codelineno-8-99 name=__codelineno-8-99></a>    IMAGE_PATH: images/img1
<a id=__codelineno-8-100 name=__codelineno-8-100></a>
<a id=__codelineno-8-101 name=__codelineno-8-101></a>
<a id=__codelineno-8-102 name=__codelineno-8-102></a>############################## SHARE JOBS
<a id=__codelineno-8-103 name=__codelineno-8-103></a>
<a id=__codelineno-8-104 name=__codelineno-8-104></a>.openstack-share-image: &amp;openstack-share-image
<a id=__codelineno-8-105 name=__codelineno-8-105></a>    - |+
<a id=__codelineno-8-106 name=__codelineno-8-106></a>      IFS=';' read -ra PROJECTS &lt;&lt;&lt; "$PROJECT_TO_SHARE"
<a id=__codelineno-8-107 name=__codelineno-8-107></a>      while IFS=';' read -ra PROJECTS; do
<a id=__codelineno-8-108 name=__codelineno-8-108></a>        for PROJECT in "${PROJECTS[@]}"; do
<a id=__codelineno-8-109 name=__codelineno-8-109></a>          export OS_PROJECT_NAME=$UPLOAD_PROJECT_NAME
<a id=__codelineno-8-110 name=__codelineno-8-110></a>          echo "Sharing image $IMAGE_TO_SHARE from $OS_PROJECT_NAME to $PROJECT"
<a id=__codelineno-8-111 name=__codelineno-8-111></a>          export IMG_ID=$(openstack image list | fgrep "$IMAGE_TO_SHARE" | cut -d " " -f 2)
<a id=__codelineno-8-112 name=__codelineno-8-112></a>          echo "Got image $IMAGE_TO_SHARE ID: $IMG_ID"
<a id=__codelineno-8-113 name=__codelineno-8-113></a>          export SHARE_ID=$(openstack project list | fgrep "$PROJECT" | cut -d " " -f 2)
<a id=__codelineno-8-114 name=__codelineno-8-114></a>          echo "Got project $PROJECT ID: $SHARE_ID"
<a id=__codelineno-8-115 name=__codelineno-8-115></a>          openstack --os-auth-type $OS_AUTH_TYPE image set --shared $IMG_ID
<a id=__codelineno-8-116 name=__codelineno-8-116></a>          openstack --os-auth-type $OS_AUTH_TYPE image add project $IMG_ID $SHARE_ID
<a id=__codelineno-8-117 name=__codelineno-8-117></a>          export OS_PROJECT_NAME=$PROJECT
<a id=__codelineno-8-118 name=__codelineno-8-118></a>          echo "Accepting image share from $PROJECT"
<a id=__codelineno-8-119 name=__codelineno-8-119></a>          openstack --os-auth-type $OS_AUTH_TYPE image set --accept $IMG_ID 
<a id=__codelineno-8-120 name=__codelineno-8-120></a>          export OS_PROJECT_NAME=$UPLOAD_PROJECT_NAME
<a id=__codelineno-8-121 name=__codelineno-8-121></a>        done
<a id=__codelineno-8-122 name=__codelineno-8-122></a>      done &lt;&lt;&lt; "$PROJECT_TO_SHARE"
<a id=__codelineno-8-123 name=__codelineno-8-123></a>
<a id=__codelineno-8-124 name=__codelineno-8-124></a>.default-share-settings:
<a id=__codelineno-8-125 name=__codelineno-8-125></a>  image:
<a id=__codelineno-8-126 name=__codelineno-8-126></a>    name: gitlab-registry.cern.ch/linuxsupport/openstack-client:latest
<a id=__codelineno-8-127 name=__codelineno-8-127></a>    entrypoint: [""]
<a id=__codelineno-8-128 name=__codelineno-8-128></a>  stage: Share Images
<a id=__codelineno-8-129 name=__codelineno-8-129></a>  script: 
<a id=__codelineno-8-130 name=__codelineno-8-130></a>    - *openstack-share-image
<a id=__codelineno-8-131 name=__codelineno-8-131></a>
<a id=__codelineno-8-132 name=__codelineno-8-132></a>.default-share-on-tag:
<a id=__codelineno-8-133 name=__codelineno-8-133></a>  rules:
<a id=__codelineno-8-134 name=__codelineno-8-134></a>    - if: '$CI_COMMIT_TAG != null'
<a id=__codelineno-8-135 name=__codelineno-8-135></a>      when: manual
<a id=__codelineno-8-136 name=__codelineno-8-136></a>
<a id=__codelineno-8-137 name=__codelineno-8-137></a>share img1 to dev:
<a id=__codelineno-8-138 name=__codelineno-8-138></a>  extends:
<a id=__codelineno-8-139 name=__codelineno-8-139></a>    - .default-share-settings
<a id=__codelineno-8-140 name=__codelineno-8-140></a>  needs: ["upload img1"]
<a id=__codelineno-8-141 name=__codelineno-8-141></a>  dependencies: 
<a id=__codelineno-8-142 name=__codelineno-8-142></a>    - upload img1 
<a id=__codelineno-8-143 name=__codelineno-8-143></a>  variables:
<a id=__codelineno-8-144 name=__codelineno-8-144></a>    PROJECT_TO_SHARE: "$DEV_PROJECT_NAME"
<a id=__codelineno-8-145 name=__codelineno-8-145></a>
<a id=__codelineno-8-146 name=__codelineno-8-146></a>share img1 to prod: 
<a id=__codelineno-8-147 name=__codelineno-8-147></a>  extends:
<a id=__codelineno-8-148 name=__codelineno-8-148></a>    - .default-share-settings
<a id=__codelineno-8-149 name=__codelineno-8-149></a>    - .default-share-on-tag
<a id=__codelineno-8-150 name=__codelineno-8-150></a>  needs: ["upload img1"]
<a id=__codelineno-8-151 name=__codelineno-8-151></a>  dependencies: 
<a id=__codelineno-8-152 name=__codelineno-8-152></a>    - upload img1 
<a id=__codelineno-8-153 name=__codelineno-8-153></a>  variables:
<a id=__codelineno-8-154 name=__codelineno-8-154></a>    PROJECT_TO_SHARE: "$PROD_PROJECT_NAME"
</code></pre></div></td></tr></tbody></table></div> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://jamfox.dev/ target=_blank rel=noopener title=jamfox.dev class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M277.8 8.6c-12.3-11.4-31.3-11.4-43.5 0l-224 208c-9.6 9-12.8 22.9-8 35.1S18.8 272 32 272h16v176c0 35.3 28.7 64 64 64h288c35.3 0 64-28.7 64-64V272h16c13.2 0 25-8.1 29.8-20.3s1.6-26.2-8-35.1zM240 320h32c26.5 0 48 21.5 48 48v96H192v-96c0-26.5 21.5-48 48-48"></path></svg> </a> <a href=https://github.com/JamFox target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg> </a> <a href=https://www.linkedin.com/in/katurv/ target=_blank rel=noopener title=www.linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"></path></svg> </a> <a href=https://www.instagram.com/karlturvas/ target=_blank rel=noopener title=www.instagram.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M224.3 141a115 115 0 1 0-.6 230 115 115 0 1 0 .6-230m-.6 40.4a74.6 74.6 0 1 1 .6 149.2 74.6 74.6 0 1 1-.6-149.2m93.4-45.1a26.8 26.8 0 1 1 53.6 0 26.8 26.8 0 1 1-53.6 0m129.7 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8M399 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1"></path></svg> </a> <a href=https://brain.jamfox.dev/ target=_blank rel=noopener title=brain.jamfox.dev class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M120 56c0-30.9 25.1-56 56-56h24c17.7 0 32 14.3 32 32v448c0 17.7-14.3 32-32 32h-32c-29.8 0-54.9-20.4-62-48h-2c-44.2 0-80-35.8-80-80 0-18 6-34.6 16-48-19.4-14.6-32-37.8-32-64 0-30.9 17.6-57.8 43.2-71.1-7.1-12-11.2-26-11.2-40.9 0-44.2 35.8-80 80-80zm272 0v24c44.2 0 80 35.8 80 80 0 15-4.1 29-11.2 40.9C486.5 214.2 504 241 504 272c0 26.2-12.6 49.4-32 64 10 13.4 16 30 16 48 0 44.2-35.8 80-80 80h-2c-7.1 27.6-32.2 48-62 48h-32c-17.7 0-32-14.3-32-32V32c0-17.7 14.3-32 32-32h24c30.9 0 56 25.1 56 56"></path></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"annotate": null, "base": "../../..", "features": ["header.autohide", "navigation.tabs", "navigation.sections", "navigation.indexes", "navigation.top", "navigation.tabs.sticky", "content.tabs.link", "search.share", "content.code.annotate", "content.code.copy", "content.action.view", "navigation.indexes", "navigation.prune"], "search": "../../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../../../assets/javascripts/bundle.e71a0d61.min.js></script> <script src=https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js></script> <script src=../../../javascripts/tablesort.js></script> <script id=init-glightbox>const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(()=>{ lightbox.reload(); });
</script></body></html>